@using WebsiteBanXeMay.ViewModels
@model List<GioHangViewModel>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Begin Li's Breadcrumb Area -->
<div class="breadcrumb-area">
    <div class="container">
        <div class="breadcrumb-content">
            <ul>
                <li><a href="index.html">Trang chủ</a></li>
                <li class="active">Giỏ hàng</li>
            </ul>
        </div>
    </div>
</div>
<!-- Li's Breadcrumb Area End Here -->
@if (Model != null && Model.Count() > 0)
{

    <!--Shopping Cart Area Strat-->
    <div class="Shopping-cart-area pt-60 pb-60">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <div class="table-content table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th class="li-product-remove">Xóa</th>
                                    <th class="li-product-thumbnail">Hình ảnh</th>
                                    <th class="cart-product-name">Tên sản phẩm</th>
                                    <th class="li-product-price">Giá</th>
                                    <th class="li-product-quantity">Số lượng</th>
                                    <th class="li-product-subtotal">Tổng tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var LoaiSanPham in Model)
                                {
                                    <tr>
                                        <td class="li-product-remove">
                                            <a data-ajax="true"
                                               data-ajax-success="success"
                                               data-ajax-failure="OnFailure"
                                               data-ajax-method="POST"
                                               data-ajax-mode="replace"
                                               data-ajax-update="#GioHangID"
                                               href="/GioHang/XoaGioHang?MaLoai=@LoaiSanPham.MALOAI">
                                                <i class="fa fa-times"></i>
                                            </a>
                                        </td>
                                        <td class="li-product-thumbnail"><a href="/LoaiSanPham/ChiTietLoaiSanPham/@LoaiSanPham.MALOAI"><img src=@Url.Content("~/Assets/upload/images/" + LoaiSanPham.HINHANH) height="100" width="110" alt="@LoaiSanPham.HINHANH"></a></td>
                                        <td class="li-product-name"><a href="/LoaiSanPham/ChiTietLoaiSanPham/@LoaiSanPham.MALOAI">@LoaiSanPham.TENLOAI</a></td>
                                        <td class="product-subtotal"><span class="amount money text-theme">@LoaiSanPham.GIA</span></td>
                                        <td class="quantity">
                                            @using (Ajax.BeginForm("SuaGioHang",
                                                                           "GioHang",
                                                                           new { MaLoai = LoaiSanPham.MALOAI },
                                                                           new AjaxOptions
                                                                           {
                                                                               HttpMethod = "POST",
                                                                               InsertionMode = InsertionMode.Replace,
                                                                               UpdateTargetId = "GioHangID",
                                                                               OnFailure = "OnFailure",
                                                                               OnSuccess = "success"
                                                                           },
                                                                           new { id = LoaiSanPham.MALOAI }))
                                            {
                                                <div class="cart-plus-minus">
                                                    <input class="cart-plus-minus-box" name="SoLuong" value="@LoaiSanPham.SOLUONG" type="text" readonly>
                                                    <div class="dec qtybutton"><i class="fa fa-angle-down"></i></div>
                                                    <div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>
                                                </div>
                                            }
                                        </td>
                                        <td class="product-subtotal"><span class="amount money text-theme">@(LoaiSanPham.GIA * LoaiSanPham.SOLUONG)</span></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="row">
                        <div class="col-md-5 ml-auto">
                            <div class="cart-page-total">
                                <h2>Tổng số tiền</h2>
                                <ul>
                                    <li>Tiền vận chuyển<span class="money text-theme">0</span></li>
                                    <li>Tổng tiền<span class="total money text-theme"></span></li>
                                </ul>
                                @Html.ActionLink("Đặt hàng", "Index", "ThanhToan");
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Shopping Cart Area End-->


    <script>
    (function ($) {
        //$(".cart-plus-minus").append('<div class="dec qtybutton"><i class="fa fa-angle-down"></i></div><div class="inc qtybutton"><i class="fa fa-angle-up"></i></div>');
        $(".qtybutton").on("click", function () {
            var $button = $(this);
            var oldValue = $button.parent().find("input").val();
            if ($button.hasClass('inc')) {
                var newVal = parseFloat(oldValue) + 1;
            } else {
                if (oldValue > 1) {
                    var newVal = parseFloat(oldValue) - 1;
                } else {
                    newVal = 1;
                }
            }
            $button.parent().find("input").val(newVal);
            $(this).submit()
        });

        var model = @Html.Raw(Json.Encode(Model));
        var lst = Object.values(model);
        var total = 0;
        for (i = 0; i < lst.length; i++) {
            total += lst[i].GIA * lst[i].SOLUONG;
        }
        $('.total').text(total)
    })(jQuery);

    function success() {
        var url = window.location.pathname;
        if (url == "/GioHang") {
            window.location.reload();
        }
    }

    </script>

}
else
{
    <span>Chưa đặt hàng</span>
}


