@using WebsiteBanXeMay.Utils;
@using WebsiteBanXeMay.ViewModels;
@model PageUtil

@{ var TaiKhoanViewModel = ViewBag.TaiKhoanViewModel as TaiKhoanViewModel;}
@if (Model.Data.Count() > 0)
{
    <div id="DanhGiaID" class="mb-30">

        @foreach (var DanhGia in Model.PaginatedResult())
        {
            <div class="row ml-10 mb-20">
                <div class="author-avatar col-lg-1 p-0">
                    <img src="/Assets/client/images/product-details/user.png" height="50" width="50" style="object-fit:contain" alt="User">
                </div>
                <div class="col-lg-11 pt-5" style="margin-left:-40px">
                    <h4 class="title-block">@DanhGia.HOTEN</h4>
                    <ul class="rating">
                        @for (int i = 0; i < DanhGia.MUCDANHGIA; i++)
                        {
                            <li><i class="fa fa-star"></i></li>
                        }
                        @for (int i = 0; i < 5 - DanhGia.MUCDANHGIA; i++)
                        {
                            <li class="no-star"><i class="fa fa-star"></i></li>
                        }
                    </ul>
                    <p class="mb-0" style="color:black !important">@Html.Raw(Html.Encode(DanhGia.NOIDUNG).Replace(Environment.NewLine, "<br />"))</p>
                    <em style="font-size:12px;color:#898989 !important">@DanhGia.NGAY.ToString("dd-MM-yyyy hh:mm tt")</em>
                </div>
                <div>
                    @if (TaiKhoanViewModel != null)
                    {
                        if (TaiKhoanViewModel.NHOMQUYEN.Equals("admin") || TaiKhoanViewModel.NHOMQUYEN.Equals("staff"))
                        {
                            <a data-ajax="true"
                               data-ajax-failure="OnFailure"
                               data-ajax-method="GET"
                               data-ajax-mode="replace"
                               data-ajax-success="OnSuccess"
                                data-ajax-confirm="Xác nhận xóa?"
                               data-ajax-update="#DanhGiaID"
                               href="/DanhGia/XoaDanhGia?MaLoai=@(DanhGia.MALOAI)&MaKH=@DanhGia.MAKH"><span style="font-size:25px">...</span></a>
                        }
                        else if (TaiKhoanViewModel.NHOMQUYEN.Equals("customer"))
                        {
                            if (TaiKhoanViewModel.MA == DanhGia.MAKH)
                            {
                                <a data-ajax="true"
                                   data-ajax-failure="OnFailure"
                                   data-ajax-method="GET"
                                   data-ajax-mode="replace"
                                   data-ajax-success="OnSuccess"
                                   data-ajax-update="#DanhGiaID"
                                   data-ajax-confirm="Xác nhận xóa?"
                                   href="/DanhGia/XoaDanhGia?MaLoai=@(DanhGia.MALOAI)&MaKH=@DanhGia.MAKH"><span style="font-size:25px">...</span></a>
                            }
                        }
                    }
                </div>
            </div>
        }
        <div class="paginatoin-area">
            <div class="row">
                <div class="col-lg-12 col-md-12">
                    <ul class="pagination-box">
                        <li>
                            @Ajax.ActionLink("Trước",
                                           "Index",
                                           "DanhGia",
                                           new { MaLoai = ViewBag.MaLoai, Trang = Model.CurrentPage > 1 ? Model.CurrentPage - 1 : 1 },
                                           new AjaxOptions
                                           {
                                               HttpMethod = "GET",
                                               UpdateTargetId = "DanhGiaID",
                                               InsertionMode = InsertionMode.Replace,                                             
                                           })
                        </li>
                        @for (int page = 1; page <= Model.PageCount(); page++)
                        {
                            <li class="@(page == Model.CurrentPage ? "CurrentPage active" : null)">
                                @Ajax.ActionLink(page.ToString(),
                                                "Index",
                                                "DanhGia",
                                                new { MaLoai = ViewBag.MaLoai, Trang = page },
                                                new AjaxOptions
                                                {
                                                    HttpMethod = "GET",
                                                    UpdateTargetId = "DanhGiaID",
                                                    InsertionMode = InsertionMode.Replace
                                                })
                            </li>
                        }
                        <li>
                            @Ajax.ActionLink("Sau",
                                           "Index",
                                           "DanhGia",
                                           new { MaLoai = ViewBag.MaLoai, Trang = Model.CurrentPage < Model.PageCount() ? Model.CurrentPage + 1 : Model.PageCount() },
                                           new AjaxOptions
                                           {
                                               HttpMethod = "GET",
                                               UpdateTargetId = "DanhGiaID",
                                               InsertionMode = InsertionMode.Replace
                                           })
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div id="DanhGiaID">
        <span>Không có đánh giá</span>
    </div>
}

